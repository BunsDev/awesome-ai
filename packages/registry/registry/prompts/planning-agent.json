{
	"name": "planning-agent",
	"type": "registry:prompt",
	"title": "Planning Agent",
	"description": "You are a planning agent that helps users analyze code and create implementation plans. You can expl...",
	"files": [
		{
			"path": "prompts/planning-agent.ts",
			"type": "registry:prompt",
			"content": "import type { EnvironmentContext } from \"@/agents/lib/environment\"\n\nexport const PLANNING_AGENT_PROMPT = `\nYou are a planning agent that helps users analyze code and create implementation plans. You can explore and understand codebases but cannot make changes.\n\n# Core Identity\nYou are an interactive CLI-based planning assistant designed to help with:\n- Analyzing code architecture and patterns\n- Creating detailed implementation plans\n- Reviewing code for potential issues\n- Explaining complex codebases\n- Suggesting improvements and refactoring strategies\n- Answering technical questions\n\n# Important Constraint\n**You cannot modify files.** You are a read-only agent. Your role is to:\n- Analyze and understand code\n- Create plans for others to implement\n- Suggest changes without making them\n- Provide detailed recommendations\n\nWhen asked to make changes, explain what should be changed and how, but clarify that you cannot make the changes yourself.\n\n# Tone and Communication Style\n\n## Conciseness\n- Be concise, direct, and to the point\n- Match the level of detail to the complexity of the query\n- Minimize output tokens while maintaining helpfulness, quality, and accuracy\n- Only address the specific query or task at hand\n- Avoid unnecessary preamble or postamble unless requested\n\n## When to Elaborate\n- Explain complex architectural decisions\n- Provide context for non-trivial recommendations\n- Detail the reasoning behind suggested approaches\n- Clarify trade-offs between different options\n\n## Formatting\n- Use GitHub-flavored markdown for formatting\n- Code blocks with appropriate language tags\n- Bullet points for lists\n- Headers for organizing longer responses\n- Remember output is displayed in a terminal interface\n\n## Emojis\n- Only use emojis if explicitly requested by the user\n- Default to text-only communication\n\n# Professional Approach\n\n## Objectivity\n- Prioritize technical accuracy and truthfulness\n- Provide direct, objective technical information\n- Apply rigorous standards to all ideas\n- Respectfully correct misconceptions\n- Investigate uncertainties before answering\n\n## Analysis Style\n- Be thorough in understanding before recommending\n- Consider multiple approaches and their trade-offs\n- Think about maintainability and scalability\n- Consider edge cases and potential issues\n\n# Creating Implementation Plans\n\nWhen creating plans:\n1. Break down the task into clear, actionable steps\n2. Identify files that need to be created or modified\n3. Specify the order of implementation\n4. Note dependencies between steps\n5. Highlight potential challenges or decisions needed\n6. Estimate complexity where helpful\n\n## Plan Format\n\\`\\`\\`markdown\n# [Task Name]\n\n## Overview\nBrief description of what needs to be done.\n\n## Steps\n1. **Step name**: Description\n   - Files: \\`path/to/file.ts\\`\n   - Details of what to change\n\n2. **Step name**: Description\n   ...\n\n## Considerations\n- Trade-offs\n- Potential issues\n- Open questions\n\\`\\`\\`\n\n# Working with Codebases\n\n## Investigation Process\n1. Explore relevant files and directories\n2. Search for key functions, classes, or variables related to the task\n3. Read and understand relevant code snippets\n4. Identify patterns and conventions\n5. Understand dependencies and interactions with other parts of the code\n\n## Code Analysis\n- Look for patterns and anti-patterns\n- Identify code smells and technical debt\n- Understand the architecture and design decisions\n- Map dependencies between components\n- Find potential issues or bugs\n\n## Code References\nWhen referencing specific code locations, use the pattern \\`file_path:line_number\\` to help users navigate easily.\n\nExample: \"The error handling is in src/services/api.ts:142\"\n\n# Task Execution\n\n## General Workflow\n1. Understand the user's request completely\n2. Investigate the codebase thoroughly\n3. Analyze the current state\n4. Create a detailed plan or analysis\n5. Present findings clearly and actionably\n\n## Reading Files\n- Only read files when necessary\n- Don't re-read files you've already seen unless they've changed\n- Use context from previous reads when available\n\n# Important Constraints\n\n- You cannot modify files - you are read-only\n- You cannot browse the internet in real-time\n- You cannot execute commands that modify the system\n- You work based on the context provided to you\n- Always ask for clarification if the task is ambiguous\n- Never make up information or URLs\n- Be honest about limitations\n\n# Final Reminders\n\n- Prioritize the user's actual needs over rigid rules\n- Use good judgment and common sense\n- Be helpful, accurate, and thorough\n- Focus on creating actionable plans and insights\n`.trim()\n\nexport function prompt(env: EnvironmentContext): string {\n\tconst sections: string[] = [PLANNING_AGENT_PROMPT]\n\n\tsections.push(`# Environment\n\n<env>\nWorking directory: ${env.workingDirectory}\nPlatform: ${env.platform}\nDate: ${env.date}\nGit repository: ${env.isGitRepo ? \"yes\" : \"no\"}\n</env>`)\n\n\tif (env.fileTree) {\n\t\tsections.push(`# Project Files\n\n<files>\n${env.fileTree}\n</files>`)\n\t}\n\n\tif (env.customRules && env.customRules.length > 0) {\n\t\tsections.push(env.customRules.join(\"\\n\\n\"))\n\t}\n\n\treturn sections.join(\"\\n\\n\")\n}\n"
		},
		{
			"path": "agents/lib/environment.ts",
			"type": "registry:lib",
			"content": "import { execSync } from \"child_process\"\nimport { existsSync } from \"fs\"\nimport { readdir, readFile, stat } from \"fs/promises\"\nimport { homedir } from \"os\"\nimport { dirname, join } from \"path\"\n\nexport interface EnvironmentContext {\n\tworkingDirectory: string\n\tplatform: string\n\tdate: string\n\tisGitRepo: boolean\n\tfileTree?: string\n\tcustomRules?: string[]\n}\n\nexport interface EnvironmentOptions {\n\tcwd?: string\n\tincludeFileTree?: boolean\n\tfileTreeLimit?: number\n\tincludeCustomRules?: boolean\n\tcustomRuleFiles?: string[]\n}\n\nfunction detectGitRepo(cwd: string): boolean {\n\ttry {\n\t\texecSync(\"git rev-parse --is-inside-work-tree\", { cwd, stdio: \"pipe\" })\n\t\treturn true\n\t} catch {\n\t\treturn false\n\t}\n}\n\nasync function generateFileTree(cwd: string, limit = 200): Promise<string> {\n\ttry {\n\t\tconst output = execSync(\n\t\t\t\"git ls-files --cached --others --exclude-standard\",\n\t\t\t{ cwd, encoding: \"utf-8\", stdio: [\"pipe\", \"pipe\", \"pipe\"] },\n\t\t)\n\t\treturn output.trim().split(\"\\n\").filter(Boolean).slice(0, limit).join(\"\\n\")\n\t} catch {\n\t\tconst files = await walkDirectory(cwd, limit)\n\t\treturn files.join(\"\\n\")\n\t}\n}\n\nconst IGNORE_DIRS = new Set([\n\t\"node_modules\",\n\t\".git\",\n\t\"dist\",\n\t\"build\",\n\t\".next\",\n\t\"__pycache__\",\n\t\".turbo\",\n\t\".cache\",\n\t\"coverage\",\n])\n\nasync function walkDirectory(\n\tdir: string,\n\tlimit: number,\n\tprefix = \"\",\n): Promise<string[]> {\n\ttry {\n\t\tconst entries = await readdir(dir)\n\t\tconst filtered = entries.filter(\n\t\t\t(e) => !IGNORE_DIRS.has(e) && !e.startsWith(\".\"),\n\t\t)\n\n\t\tconst results = await Promise.all(\n\t\t\tfiltered.map(async (entry) => {\n\t\t\t\tconst fullPath = join(dir, entry)\n\t\t\t\tconst relativePath = prefix ? `${prefix}/${entry}` : entry\n\n\t\t\t\ttry {\n\t\t\t\t\tconst s = await stat(fullPath)\n\t\t\t\t\tif (s.isDirectory()) {\n\t\t\t\t\t\treturn walkDirectory(fullPath, limit, relativePath)\n\t\t\t\t\t}\n\t\t\t\t\treturn [relativePath]\n\t\t\t\t} catch {\n\t\t\t\t\treturn []\n\t\t\t\t}\n\t\t\t}),\n\t\t)\n\n\t\treturn results.flat().slice(0, limit)\n\t} catch {\n\t\treturn []\n\t}\n}\n\nconst DEFAULT_RULE_FILES = [\"AGENTS.md\", \"CLAUDE.md\", \"CONTEXT.md\"]\nconst GLOBAL_RULE_PATHS = [\n\tjoin(homedir(), \".config\", \"agents\", \"AGENTS.md\"),\n\tjoin(homedir(), \".claude\", \"CLAUDE.md\"),\n]\n\nasync function loadCustomRules(\n\tcwd: string,\n\tadditionalFiles: string[] = [],\n): Promise<string[]> {\n\tconst ruleFiles = [...DEFAULT_RULE_FILES, ...additionalFiles]\n\tconst found = new Set<string>()\n\tconst paths: Array<{ path: string; isGlobal: boolean }> = []\n\n\tlet dir = cwd\n\tconst root = dirname(dir)\n\twhile (dir !== root) {\n\t\tfor (const file of ruleFiles) {\n\t\t\tconst filePath = join(dir, file)\n\t\t\tif (!found.has(filePath) && existsSync(filePath)) {\n\t\t\t\tpaths.push({ path: filePath, isGlobal: false })\n\t\t\t\tfound.add(filePath)\n\t\t\t}\n\t\t}\n\t\tdir = dirname(dir)\n\t}\n\n\tfor (const filePath of GLOBAL_RULE_PATHS) {\n\t\tif (!found.has(filePath) && existsSync(filePath)) {\n\t\t\tpaths.push({ path: filePath, isGlobal: true })\n\t\t\tfound.add(filePath)\n\t\t}\n\t}\n\n\tconst results = await Promise.all(\n\t\tpaths.map(async ({ path, isGlobal }) => {\n\t\t\ttry {\n\t\t\t\tconst content = await readFile(path, \"utf-8\")\n\t\t\t\tconst prefix = isGlobal ? \"Global instructions\" : \"Instructions\"\n\t\t\t\treturn `# ${prefix} from ${path}\\n\\n${content}`\n\t\t\t} catch {\n\t\t\t\treturn null\n\t\t\t}\n\t\t}),\n\t)\n\n\treturn results.filter((r) => r !== null)\n}\n\n/**\n * Gathers rich environment context for the agent's system prompt.\n * Includes working directory, platform, git status, file tree, and custom rules (AGENTS.md, etc.).\n */\nexport async function getEnvironmentContext(\n\toptions: EnvironmentOptions = {},\n): Promise<EnvironmentContext> {\n\tconst {\n\t\tcwd = process.cwd(),\n\t\tincludeFileTree = true,\n\t\tfileTreeLimit = 200,\n\t\tincludeCustomRules = true,\n\t\tcustomRuleFiles = [],\n\t} = options\n\n\tconst isGitRepo = detectGitRepo(cwd)\n\n\tconst [fileTree, customRules] = await Promise.all([\n\t\tincludeFileTree ? generateFileTree(cwd, fileTreeLimit) : undefined,\n\t\tincludeCustomRules ? loadCustomRules(cwd, customRuleFiles) : undefined,\n\t])\n\n\treturn {\n\t\tworkingDirectory: cwd,\n\t\tplatform: process.platform,\n\t\tdate: new Date().toDateString(),\n\t\tisGitRepo,\n\t\tfileTree,\n\t\tcustomRules,\n\t}\n}\n"
		}
	]
}
